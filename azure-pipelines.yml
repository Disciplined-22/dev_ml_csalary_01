trigger:
- main

pool:
  vmImage: 'ubuntu-latest'

steps:
- task: UsePythonVersion@0
  inputs:
    versionSpec: '3.x'
    addToPath: true

- script: |
    python -m pip install --upgrade pip
    pip install azureml-core azureml-sdk
  displayName: 'Install Azure ML SDK'

- checkout: self

- task: AzureCLI@2
  inputs:
    azureSubscription: 'azure'
    scriptType: 'bash'
    scriptLocation: 'inlineScript'
    inlineScript: |
      az storage blob download \
        --container-name gamer \
        --name gamer \
        --file candidate_information.csv \
        --connection-string $(az storage account show-connection-string \
                               --name gamerwe \
                               --query connectionString \
                               --output tsv)
      if [ $? -eq 0 ]; then
            echo "CSV file downloaded successfully."
          else
            echo "Failed to download CSV file."
            exit 1
          fi
  displayName: 'Download CSV from Azure Blob Storage'

- script: |
    python train.py
  displayName: 'Train Model'

- script: |
    python evaluate.py
  displayName: 'Evaluate Model'

- script: |
    python deploy.py
  displayName: 'Deploy Model'
